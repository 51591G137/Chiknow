<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiknow - Tarjetas de Estudio</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

    <header>
        <h1>ğŸ—‚ï¸ Tarjetas de Estudio</h1>
        <p class="subtitle">Todas las tarjetas generadas</p>
    </header>

    <main id="content">
        <section id="tarjetas-section">
            <div class="section-header">
                <h2>Mis Tarjetas</h2>
                <div class="stats">
                    <span class="stat-item">Total: <strong id="total-tarjetas">0</strong></span>
                    <span class="stat-item">Palabras: <strong id="total-palabras">0</strong></span>
                </div>
            </div>
            <div id="lista-tarjetas"></div>
        </section>
    </main>

    <nav class="bottom-nav">
        <a href="/" class="nav-item">
            <span class="nav-icon">ğŸ“š</span>
            <span class="nav-label">HSK</span>
        </a>
        <a href="/diccionario" class="nav-item">
            <span class="nav-icon">ğŸ“–</span>
            <span class="nav-label">Diccionario</span>
        </a>
        <a href="/ejemplos" class="nav-item">
            <span class="nav-icon">ğŸ’¬</span>
            <span class="nav-label">Ejemplos</span>
        </a>
        <a href="/tarjetas" class="nav-item active">
            <span class="nav-icon">ğŸ—‚ï¸</span>
            <span class="nav-label">Tarjetas</span>
        </a>
        <a href="/sm2" class="nav-item">
            <span class="nav-icon">ğŸ§ </span>
            <span class="nav-label">Estudiar</span>
        </a>
    </nav>

    <script>
        async function cargarTarjetas() {
            try {
                const [resTarjetas, resStats] = await Promise.all([
                    fetch('/api/tarjetas'),
                    fetch('/api/tarjetas/estadisticas')
                ]);
                
                const tarjetas = await resTarjetas.json();
                const stats = await resStats.json();
                
                document.getElementById('total-tarjetas').textContent = stats.total_tarjetas;
                document.getElementById('total-palabras').textContent = stats.total_palabras_diccionario;
                
                const contenedor = document.getElementById('lista-tarjetas');
                
                if (tarjetas.length === 0) {
                    contenedor.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ—‚ï¸</div>
                            <h3>No hay tarjetas aÃºn</h3>
                            <p>AÃ±ade palabras al diccionario para generar tarjetas de estudio</p>
                            <a href="/" class="btn-primary">Ir a Lista HSK</a>
                        </div>
                    `;
                    return;
                }
                
                const tarjetasPorPalabra = agruparPorPalabra(tarjetas);
                
                contenedor.innerHTML = Object.keys(tarjetasPorPalabra).map(hanzi => {
                    const grupo = tarjetasPorPalabra[hanzi];
                    const primera = grupo[0];
                    
                    return `
                        <div class="tarjeta-grupo">
                            <div class="tarjeta-grupo-header">
                                <div class="hanzi-lg">${primera.hanzi}</div>
                                <div class="grupo-info">
                                    <div class="pinyin">${primera.pinyin}</div>
                                    <div class="espanol">${primera.espanol}</div>
                                </div>
                                <span class="tarjetas-badge">${grupo.length} tarjetas</span>
                            </div>
                            <div class="tarjeta-grupo-items">
                                ${grupo.map((t, idx) => renderizarTarjeta(t, idx)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar tarjetas:', error);
                document.getElementById('lista-tarjetas').innerHTML = 
                    '<p class="error-message">Error al cargar las tarjetas.</p>';
            }
        }

        function renderizarTarjeta(tarjeta, indice) {
            // Determinar quÃ© se muestra y quÃ© se requiere
            let preguntaHTML = '';
            
            if (tarjeta.mostrado1) {
                preguntaHTML += `<span class="mostrado">${tarjeta.mostrado1}</span>`;
            }
            
            if (tarjeta.mostrado2) {
                preguntaHTML += `<span class="mostrado secondary">${tarjeta.mostrado2}</span>`;
            }
            
            if (tarjeta.audio) {
                preguntaHTML += '<span class="audio-icon">ğŸ”Š</span>';
            }
            
            // Si no hay nada visual, es solo audio
            if (!tarjeta.mostrado1 && !tarjeta.mostrado2 && tarjeta.audio) {
                preguntaHTML = '<span class="solo-audio">Solo Audio</span>';
            }
            
            return `
                <div class="tarjeta-item">
                    <div class="tarjeta-numero">#${indice + 1}</div>
                    <div class="tarjeta-content">
                        <div class="tarjeta-pregunta">
                            ${preguntaHTML}
                        </div>
                        <div class="tarjeta-respuesta">
                            <span class="arrow">â†’</span>
                            <span class="requerido">${tarjeta.requerido}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function agruparPorPalabra(tarjetas) {
            return tarjetas.reduce((grupos, tarjeta) => {
                if (!grupos[tarjeta.hanzi]) {
                    grupos[tarjeta.hanzi] = [];
                }
                grupos[tarjeta.hanzi].push(tarjeta);
                return grupos;
            }, {});
        }

        window.onload = cargarTarjetas;
    </script>

</body>
</html>