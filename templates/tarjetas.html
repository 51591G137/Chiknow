<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiknow - Tarjetas de Estudio</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

    <header>
        <h1>üóÇÔ∏è Tarjetas de Estudio</h1>
        <p class="subtitle">Todas las tarjetas generadas</p>
    </header>

    <main id="content">
        <section id="tarjetas-section">
            <div class="section-header">
                <h2>Mis Tarjetas</h2>
                <div class="stats">
                    <span class="stat-item">Total: <strong id="total-tarjetas">0</strong></span>
                    <span class="stat-item">Palabras: <strong id="total-palabras">0</strong></span>
                </div>
            </div>
            <div id="lista-tarjetas"></div>
        </section>
    </main>

    <nav class="bottom-nav">
        <a href="/" class="nav-item">
            <span class="nav-icon">3.0</span>
            <span class="nav-label">HSK</span>
        </a>
        <a href="/diccionario" class="nav-item">
            <span class="nav-icon">üìñ</span>
            <span class="nav-label">Diccionario</span>
        </a>
        <a href="/ejemplos" class="nav-item">
            <span>üí¨</span>
            <span class="nav-label">Ejemplos</span>
        </a>
        <a href="/tarjetas" class="nav-item active">
            <span>üóÇÔ∏è</span>
            <span class="nav-label">Tarjetas</span>
        </a>
        <a href="/sm2" class="nav-item">
            <span>üß†</span>
            <span class="nav-label">Estudiar</span>
        </a>
    </nav>

    <script>
        async function cargarTarjetas() {
            try {
                const [resTarjetas, resStats] = await Promise.all([
                    fetch('/api/tarjetas'),
                    fetch('/api/tarjetas/estadisticas')
                ]);
                
                const tarjetas = await resTarjetas.json();
                const stats = await resStats.json();
                
                document.getElementById('total-tarjetas').textContent = stats.total_tarjetas;
                document.getElementById('total-palabras').textContent = stats.total_palabras_diccionario;
                
                const contenedor = document.getElementById('lista-tarjetas');
                
                if (tarjetas.length === 0) {
                    contenedor.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üóÇÔ∏è</div>
                            <h3>No hay tarjetas a√∫n</h3>
                            <p>A√±ade palabras al diccionario para generar tarjetas de estudio</p>
                            <a href="/" class="btn-primary">Ir a Lista HSK</a>
                        </div>
                    `;
                    return;
                }
                
                const tarjetasPorPalabra = agruparPorPalabra(tarjetas);
                
                contenedor.innerHTML = Object.keys(tarjetasPorPalabra).map(hanzi => {
                    const grupo = tarjetasPorPalabra[hanzi];
                    const primera = grupo[0];
                    
                    return `
                        <div class="tarjeta-grupo">
                            <div class="tarjeta-grupo-header">
                                <div class="hanzi-lg">${primera.hanzi}</div>
                                <div class="grupo-info">
                                    <div class="pinyin">${primera.pinyin}</div>
                                    <div class="espanol">${primera.espanol}</div>
                                </div>
                                <span class="tarjetas-badge">${grupo.length} tarjetas</span>
                            </div>
                            <div class="tarjeta-grupo-items">
                                ${grupo.map((t, idx) => renderizarTarjeta(t, idx)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error al cargar tarjetas:', error);
                document.getElementById('lista-tarjetas').innerHTML = 
                    '<p class="error-message">Error al cargar las tarjetas.</p>';
            }
        }

        function renderizarTarjeta(tarjeta, indice) {
            // Determinar qu√© se muestra y qu√© se requiere
            let preguntaHTML = '';
            
            if (tarjeta.mostrado1) {
                preguntaHTML += `<span class="mostrado">${tarjeta.mostrado1}</span>`;
            }
            
            if (tarjeta.mostrado2) {
                preguntaHTML += `<span class="mostrado secondary">${tarjeta.mostrado2}</span>`;
            }
            
            if (tarjeta.audio) {
                preguntaHTML += '<span class="audio-icon">üîä</span>';
            }
            
            // Si no hay nada visual, es solo audio
            if (!tarjeta.mostrado1 && !tarjeta.mostrado2 && tarjeta.audio) {
                preguntaHTML = '<span class="solo-audio">Solo Audio</span>';
            }
            
            return `
                <div class="tarjeta-item">
                    <div class="tarjeta-numero">#${indice + 1}</div>
                    <div class="tarjeta-content">
                        <div class="tarjeta-pregunta">
                            ${preguntaHTML}
                        </div>
                        <div class="tarjeta-respuesta">
                            <span class="arrow">‚Üí</span>
                            <span class="requerido">${tarjeta.requerido}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function agruparPorPalabra(tarjetas) {
            return tarjetas.reduce((grupos, tarjeta) => {
                if (!grupos[tarjeta.hanzi]) {
                    grupos[tarjeta.hanzi] = [];
                }
                grupos[tarjeta.hanzi].push(tarjeta);
                return grupos;
            }, {});
        }

        window.onload = cargarTarjetas;
    </script>

    <style>
        /* Estilos espec√≠ficos mejorados para tarjetas */
        .tarjeta-grupo {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .tarjeta-grupo-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tarjeta-grupo-header .hanzi-lg {
            font-size: 2.5rem;
            min-width: auto;
        }

        .grupo-info {
            flex: 1;
            min-width: 200px;
        }

        .tarjetas-badge {
            background: var(--primary);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .tarjeta-grupo-items {
            display: grid;
            gap: 12px;
        }

        .tarjeta-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-alt);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .tarjeta-numero {
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .tarjeta-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tarjeta-pregunta {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            min-width: 150px;
            flex: 1;
        }

        .mostrado {
            padding: 6px 12px;
            background: #e0e7ff;
            color: #4338ca;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .mostrado.secondary {
            background: #fef3c7;
            color: #92400e;
        }

        .audio-icon {
            font-size: 1.2rem;
        }

        .solo-audio {
            color: var(--text-light);
            font-style: italic;
            font-size: 0.9rem;
        }

        .tarjeta-respuesta {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .arrow {
            color: var(--text-light);
            font-size: 1.5rem;
        }

        .requerido {
            padding: 8px 16px;
            background: var(--success);
            color: white;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* Responsive para m√≥vil */
        @media (max-width: 768px) {
            .tarjeta-grupo {
                padding: 16px;
            }

            .tarjeta-grupo-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .tarjeta-grupo-header .hanzi-lg {
                font-size: 2rem;
            }

            .grupo-info {
                width: 100%;
            }

            .tarjetas-badge {
                align-self: flex-start;
            }

            .tarjeta-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 12px;
            }

            .tarjeta-content {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                gap: 12px;
            }

            .tarjeta-pregunta {
                width: 100%;
            }

            .tarjeta-respuesta {
                width: 100%;
            }

            .arrow {
                font-size: 1.2rem;
            }
        }
    </style>
</body>
</html>